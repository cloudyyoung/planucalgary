enum CourseComponent {
  LAB
  LECTURE
  SECTION
  SEMINAR
  SUPERVISED_STUDY
  TUTORIAL

  @@schema("catalog")
}

enum Career {
  UNDERGRADUATE_PROGRAM
  GRADUATE_PROGRAM
  MEDICINE_PROGRAM

  @@schema("catalog")
}

model Course {
  id         String   @id
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  course_id       String @unique
  course_group_id String

  code          String
  course_number String

  subject_code String
  subject      Subject @relation(fields: [subject_code], references: [code])

  description String?
  name        String
  long_name   String
  notes       String?
  version     Int
  units       Int?
  aka         String?

  consent      String?
  drop_consent String?

  prereq       String?
  prereq_json  Json?
  coreq        String?
  coreq_json   Json?
  antireq      String?
  antireq_json Json?

  raw_requisites    Json?
  requisites        Requisite[]
  prereq_id         String?
  prereq_requisite  Requisite?  @relation("course_prereq", fields: [prereq_id], references: [id])
  coreq_id          String?
  coreq_requisite   Requisite?  @relation("course_coreq", fields: [coreq_id], references: [id])
  antireq_id        String?
  antireq_requisite Requisite?  @relation("course_antireq", fields: [antireq_id], references: [id])

  is_archived         Boolean
  is_can_schedule     Boolean
  is_catalog_print    Boolean
  is_blind_grading    Boolean
  is_course_approved  Boolean
  is_exam_only_course Boolean

  is_active     Boolean
  is_multi_term Boolean
  is_no_gpa     Boolean
  is_repeatable Boolean

  components CourseComponent[]

  course_created_at           DateTime
  course_effective_start_date DateTime?
  course_effective_end_date   DateTime?
  course_last_updated_at      DateTime
  course_last_synced_at       DateTime

  start_term Json?
  end_term   Json?

  departments Department[]
  faculties   Faculty[]

  career     Career
  topics     CourseTopic[]
  grade_mode GradeMode

  search_vector Unsupported("tsvector")? @default(dbgenerated())

  requisite_rules RequisiteRule[]

  @@index([search_vector], type: Gin, map: "course_search_vector_gin")
  @@map("courses")
  @@schema("catalog")
}

model CourseTopic {
  id         String   @id
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  number        String  @map("number")
  name          String
  long_name     String
  description   String?
  is_repeatable Boolean
  units         Int?
  link          String

  course_id String
  course    Course @relation(fields: [course_id], references: [id])

  @@unique([number, course_id], map: "course_topic_number_course_unique")
  @@map("courses_topics")
  @@schema("catalog")
}

model CourseSet {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  fields_of_study FieldOfStudy[]
  requisite_rules RequisiteRule[]

  csid                String  @unique
  course_set_group_id String  @unique
  type                String
  name                String
  description         String?
  json                Json?
  raw_json            Json?

  course_set_created_at      DateTime
  course_set_last_updated_at DateTime

  @@map("course_sets")
  @@schema("catalog")
}

enum RequisiteType {
  PREREQ
  COREQ
  ANTIREQ
  COURSE_SET
  REQUISITE_SET

  @@schema("catalog")
}

model RequisiteJson {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  requisite_type RequisiteType
  text           String
  departments    String[]
  faculties      String[]

  json_choices Json[]
  json         Json?
  raw_json     Json?

  @@unique([requisite_type, text, departments, faculties], map: "requisite_components_unique")
  @@map("requisites_jsons")
  @@schema("catalog")
}

model Faculty {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  name         String
  display_name String
  code         String  @unique
  is_active    Boolean

  departments Department[]
  courses     Course[]
  programs    Program[]
  subjects    Subject[]

  @@index([code], map: "faculty_code_unique")
  @@map("faculties")
  @@schema("catalog")
}

model Department {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  name         String
  display_name String
  code         String  @unique
  is_active    Boolean

  faculties Faculty[]
  courses   Course[]
  subjects  Subject[]
  programs  Program[]

  @@map("departments")
  @@schema("catalog")
}

enum GradeMode {
  CDF // Credit/D grade/Fail
  CNC // Credit/No Credit
  CRF // Credit/Fail
  ELG // English Language Graded
  GRD // Graded
  MTG // Multi-Term

  @@schema("catalog")
}

model Subject {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  code  String @unique
  title String

  faculties   Faculty[]
  departments Department[]
  courses     Course[]

  @@unique([code], map: "subject_code_unique")
  @@map("subjects")
  @@schema("catalog")
}

enum TermName {
  WINTER
  SPRING
  SUMMER
  FALL

  @@schema("catalog")
}

model Program {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  departments     Department[]
  faculties       Faculty[]
  requisites      Requisite[]
  requisite_rules RequisiteRule[]

  pid              String @unique
  coursedog_id     String
  program_group_id String

  code         String @unique
  name         String
  long_name    String
  display_name String

  type                    String
  degree_designation_code String?
  degree_designation_name String?
  career                  Career

  admission_info String?
  general_info   String?

  transcript_level       Int?
  transcript_description String?

  is_active  Boolean
  start_term Json?

  program_created_at           DateTime
  program_last_updated_at      DateTime
  program_effective_start_date DateTime

  version Int

  raw_requisites Json?

  search_vector Unsupported("tsvector")? @default(dbgenerated())

  @@index([search_vector], type: Gin, map: "program_search_vector_gin")
  @@map("programs")
  @@schema("catalog")
}

model FieldOfStudy {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  name        String  @unique
  description String?
  notes       String?

  course_sets CourseSet[]

  @@map("fields_of_study")
  @@schema("catalog")
}

// Reference: https://coursedogcurriculum.docs.apiary.io/#reference/requisites
model Requisite {
  id         String   @id
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  courses         Course[]
  prereq_courses  Course[]  @relation("course_prereq")
  coreq_courses   Course[]  @relation("course_coreq")
  antireq_courses Course[]  @relation("course_antireq")
  programs        Program[]

  type  String
  name  String
  notes String?

  raw_rules Json?
  rules     RequisiteRule[]

  @@map("requisites")
  @@schema("catalog")
}

// Reference: https://coursedogcurriculum.docs.apiary.io/#reference/requisites
model RequisiteRule {
  id         String   @id
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  requisite_id String
  requisite    Requisite @relation(fields: [requisite_id], references: [id])

  parent_rule_id String?
  parent_rule    RequisiteRule?  @relation("RequisiteRuleToRequisiteRule", fields: [parent_rule_id], references: [id])
  sub_rules      RequisiteRule[] @relation("RequisiteRuleToRequisiteRule")

  name        String
  description String?
  notes       String?
  condition   String
  min_courses Int?
  max_courses Int?
  min_credits Int?
  max_credits Int?
  credits     Int?
  number      Int?
  restriction String?
  grade       String?
  grade_type  String?

  // Simplify the Coursedog `value` structure, currently `condition` is only valued with `courseSets` or `requisiteSets`
  course_sets    CourseSet[]
  requisite_sets RequisiteSet[]
  courses        Course[]
  programs       Program[]

  raw_json Json?

  @@map("requisite_rules")
  @@schema("catalog")
}

model RequisiteSet {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  requisite_rules RequisiteRule[]

  csid                   String  @unique
  requisite_set_group_id String  @unique
  version                Int
  name                   String
  description            String?
  json                   Json?
  raw_json               Json?

  requisite_set_created_at      DateTime
  requisite_set_last_updated_at DateTime

  @@map("requisite_sets")
  @@schema("catalog")
}
